{{- /* =========================
   THEME INITIALIZATION
   ========================= */}}

{{- if (not site.Params.disableThemeToggle) }}
  {{- if (eq site.Params.defaultTheme "light") }}
    <script>
      if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
      }
    </script>
  {{- else if (eq site.Params.defaultTheme "dark") }}
    <script>
      if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark');
      }
    </script>
  {{- else }}
    <script>
      if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
      } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark');
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
    </script>
  {{- end }}
{{- else if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark")) }}
  <script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark');
    }
  </script>
{{- end }}

<header class="header">
  <nav class="nav">
    <div class="logo">
      {{- $label_text := (site.Params.label.text | default site.Title) }}
      <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
        {{- if site.Params.label.icon }}
          <img src="{{ site.Params.label.icon | absURL }}"
               alt=""
               height="{{ site.Params.label.iconHeight | default "30" }}">
        {{- end }}
        {{- $label_text -}}
      </a>

      {{- if (not site.Params.disableThemeToggle) }}
      <button id="theme-toggle" accesskey="t" title="(Alt + T)">
        <svg id="moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3z"/></svg>
        <svg id="sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/></svg>
      </button>
      {{- end }}
    </div>

    {{- $currentPage := . }}

    <ul id="menu">
      {{- range site.Menus.main }}

        {{- $menuURL := .URL | absLangURL }}
        {{- $pageURL := $currentPage.Permalink | absLangURL }}

        {{- if .HasChildren }}
          <li class="menu-item has-children">
            <a href="{{ .URL | absLangURL }}">
              <span {{ if eq $menuURL $pageURL }}class="active"{{ end }}>
                {{ .Name }} â–¾
              </span>
            </a>
            <ul class="sub-menu">
              {{- range .Children }}
                <li>
                  <a href="{{ .URL | absLangURL }}">{{ .Name }}</a>
                </li>
              {{- end }}
            </ul>
          </li>
        {{- else }}
          <li class="menu-item">
            <a href="{{ .URL | absLangURL }}">
              <span {{ if eq $menuURL $pageURL }}class="active"{{ end }}>
                {{ .Name }}
              </span>
            </a>
          </li>
        {{- end }}

      {{- end }}
    </ul>
  </nav>
</header>